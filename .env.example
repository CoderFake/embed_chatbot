# ============================================================================
# Environment Configuration for Chatbot Embed Platform
# Copy this file to .env and customize for your environment
# ============================================================================

# ============================================================================
# Application Environment
# ============================================================================
# Options: dev, stg, prod
# - dev: DEBUG=true, RELOAD=true (auto), open docs, colored logs, uvicorn
# - stg: Gunicorn 2 workers, protected docs, debug logs
# - prod: Gunicorn 4 workers, protected docs, info logs
# Note: RELOAD is automatically enabled when ENV=dev, no need to set manually
ENV=dev

# Development Mode Settings
# DEV_SKIP_ORIGIN_CHECK: Skip origin validation for widget/chat endpoints in dev mode
# Set to true to allow all origins without checking allowed_origins table
# Only works when ENV=dev for security
DEV_SKIP_ORIGIN_CHECK=false

# Application
APP_NAME=Chatbot Embed Platform
APP_VERSION=1.0.0
API_V1_PREFIX=/api/v1
TIMEZONE=UTC

# API Documentation (required for stg/prod, leave empty in dev for open access)
DOCS_USERNAME=admin
DOCS_PASSWORD=change_this_secure_password

# ============================================================================
# Docker Compose - External Ports (Host Machine)
# ============================================================================
API_PORT=18000          # Backend API external port
POSTGRES_PORT=15432     # PostgreSQL external port
REDIS_PORT=16379        # Redis external port
MILVUS_PORT=19532       # Milvus external port
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
CRAWL4AI_PORT=11235

# ============================================================================
# Docker Compose - Database
# ============================================================================
POSTGRES_DB=chatbot_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres_secure_password_change_this

# Backend will use this URL (internal docker network uses port 5432)
DATABASE_URL=postgresql+asyncpg://postgres:postgres_secure_password_change_this@postgres:5432/chatbot_db
DB_ECHO=false
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# ============================================================================
# Docker Compose - Redis
# ============================================================================
REDIS_PASSWORD=

# Backend Redis config (internal docker network uses port 6379)
REDIS_HOST=redis
REDIS_DB=0
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ============================================================================
# Docker Compose - MinIO
# ============================================================================
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin_secure_password_change_this

# Backend MinIO config
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin_secure_password_change_this
MINIO_BUCKET_NAME=chatbot-documents
MINIO_SECURE=false

# ============================================================================
# Docker Compose - Milvus
# ============================================================================
# Backend Milvus config (internal docker network uses port 19530)
MILVUS_HOST=milvus
MILVUS_USER=
MILVUS_PASSWORD=
MILVUS_VECTOR_DIM=512

# ============================================================================
# Docker Compose - Crawl4AI
# ============================================================================
CRAWL4AI_API_TOKEN=your-secret-crawl4ai-token-change-this

# Backend Crawl4AI config
CRAWL4AI_URL=http://crawl4ai:11235
CRAWL4AI_TIMEOUT=30

# ============================================================================
# Backend - Gunicorn Configuration (for stg/prod)
# ============================================================================
PORT=8000
WORKERS=4
MAX_REQUESTS=1000
MAX_REQUESTS_JITTER=100
TIMEOUT=120
GRACEFUL_TIMEOUT=60
KEEP_ALIVE=5
LOG_LEVEL=info

# ============================================================================
# Cache TTL Configuration (seconds)
# ============================================================================
CACHE_DEFAULT_TTL=3600
CACHE_USER_TTL=3600
CACHE_BOT_TTL=3600
CACHE_DOCUMENT_TTL=1800
CACHE_VISITOR_TTL=1800
CACHE_PROVIDER_TTL=7200
CACHE_MODEL_TTL=7200
CACHE_BOT_CONFIG_TTL=3600
CACHE_ALLOWED_ORIGINS_TTL=3600
CACHE_ANALYTICS_OVERVIEW_TTL=300
CACHE_ANALYTICS_BOT_TTL=300
CACHE_LIST_TTL=600
CACHE_BLACKLIST_TTL=86400
CACHE_RATE_LIMIT_TTL=60

# ============================================================================
# JWT Configuration
# ============================================================================
JWT_SECRET_KEY=your-super-secret-jwt-key-change-this-in-production-minimum-32-characters
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7
WIDGET_TOKEN_EXPIRE_HOURS=1
INVITE_TOKEN_EXPIRE_DAYS=7

# ============================================================================
# Password & Encryption
# ============================================================================
PASSWORD_MIN_LENGTH=8
PASSWORD_RESET_EXPIRE_HOURS=1
ENCRYPTION_KEY=your-encryption-key-for-api-keys-32-characters-long

# ============================================================================
# Root User (Initial Setup)
# ============================================================================
# This user will be created automatically on first database initialization
# Leave empty to skip root user creation
ROOT_EMAIL=admin@example.com
ROOT_PASSWORD=ChangeThisSecurePassword123

# ============================================================================
# Rate Limiting
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_WIDGET_PER_MINUTE=20
RATE_LIMIT_IP_PER_MINUTE=100

# ============================================================================
# Embedding Model Configuration
# ============================================================================
EMBEDDING_MODEL_NAME=BAAI/bge-m3
EMBEDDING_DEVICE=cpu
EMBEDDING_BATCH_SIZE=32

# ============================================================================
# Text Processing
# ============================================================================
CHUNK_SIZE=512
CHUNK_OVERLAP=128

# ============================================================================
# Crawl Configuration
# ============================================================================
CRAWL_MAX_PAGES=100
CRAWL_MAX_DEPTH=3
CRAWL_MAX_CONCURRENT=5
CRAWL_PROGRESS_INTERVAL=5

# ============================================================================
# CORS Configuration
# ============================================================================
# Must be JSON arrays! Examples:
# - All origins: ["*"]
# - Specific origins: ["http://localhost:3000","https://example.com"]
CORS_ORIGINS=["*"]
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=["*"]
CORS_ALLOW_HEADERS=["*"]

# ============================================================================
# Email Configuration (Optional)
# ============================================================================
SMTP_HOST=
SMTP_PORT=587
SMTP_TLS=true
SMTP_USER=
SMTP_PASS=
EMAIL_FROM=
EMAIL_FROM_NAME=Chatbot Platform
EMAIL_TEMPLATES_DIR=app/static/templates
FRONTEND_URL=http://localhost:3000

# ============================================================================
# Background Tasks
# ============================================================================
WORKER_CONCURRENCY=4
JOB_TIMEOUT=3600
WORKER_COUNT=2
JOB_QUEUE_TIMEOUT=5
JOB_DATA_TTL=86400

# ============================================================================
# Monitoring (Optional)
# ============================================================================
SENTRY_DSN=
ENABLE_METRICS=false

# ============================================================================
# Webhook Secret (Shared between backend, file-server, and visitor-grader)
# ============================================================================
BACKEND_WEBHOOK_SECRET=change-this-webhook-secret-shared-between-services

# ============================================================================
# Visitor Lead Grading Configuration
# ============================================================================
# LLM Provider: openai, gemini, or ollama
LLM_PROVIDER=openai

# OpenAI Configuration (if LLM_PROVIDER=openai)
OPENAI_API_KEY=your-openai-api-key-here
OPENAI_GRADING_MODEL=gpt-4o-mini
OPENAI_GRADING_TEMPERATURE=0.3
OPENAI_GRADING_MAX_TOKENS=1000

# Google Gemini Configuration (if LLM_PROVIDER=gemini)
GEMINI_API_KEY=your-gemini-api-key-here
GEMINI_GRADING_MODEL=gemini-1.5-flash
GEMINI_GRADING_TEMPERATURE=0.3
GEMINI_GRADING_MAX_TOKENS=1000

# Ollama Configuration (if LLM_PROVIDER=ollama)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_GRADING_MODEL=llama3.1:8b
OLLAMA_GRADING_TEMPERATURE=0.3
OLLAMA_GRADING_MAX_TOKENS=1000

# Visitor Grading Queue & Webhook
VISITOR_GRADING_QUEUE=visitor_grading_queue
VISITOR_GRADER_WEBHOOK_URL=http://backend:8000/api/v1/webhooks/visitor-grading
VISITOR_GRADER_PREFETCH_COUNT=1
VISITOR_GRADER_RECONNECT_DELAY=5
VISITOR_GRADER_WEBHOOK_TIMEOUT=30
VISITOR_GRADER_WEBHOOK_MAX_RETRIES=3
VISITOR_GRADER_LOG_LEVEL=INFO

# Lead Scoring Thresholds (0-100 scale)
HOT_LEAD_THRESHOLD=70
WARM_LEAD_THRESHOLD=40

